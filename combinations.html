<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sentence Order Game</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet"/>

  <style>
/* --- Fonts --- */
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

/* --- Design tokens (–∫–∞–∫ –≤ —ç—Ç–∞–ª–æ–Ω–µ) --- */
:root{
  --bg:#f5f5f7;
  --fg:#1f2228;
  --muted:#876445;
  --green:#198754;
  --red:#d9534f;
  --tile:#ffffff;
  --tile-border:#30363d22;
}

/* --- Reset / base --- */
*,*::before,*::after{ box-sizing:border-box; }

html,body{
  margin:0; padding:0; height:100%;
  background:var(--bg); color:var(--fg);
  font-family:"Nunito",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  font-weight:400; font-style:normal;
  
}

/* --- Header --- */
.header-container{
  max-width:1400px; margin:16px auto 0; padding:0 16px;
  display:flex; align-items:center; gap:16px;
  color: #ad550c;
}
.header-image{ height:48px; width:auto; object-fit:contain; }
.score-box{ margin-left:auto; display:flex; align-items:center; gap:8px; }
.score-line{ font-weight:700; }
hr{ border:none; border-top:1px solid #ddd; margin:8px 0 0; }

/* --- Layout --- */
.main-container{
  display:flex; flex-direction:column;
  max-width:1400px; margin:0 auto; padding:16px;
  min-height:calc(100vh - 88px);
}
.text-box{
  order:1; display:flex; flex-direction:column;
  align-items:center; justify-content:flex-start; text-align:center;
}
.image-box{
  order:2; display:flex; justify-content:center; align-items:center; margin-top:14px;
}
.status-image{ width:auto; max-width:100%; height:240px; object-fit:contain; }

/* --- Desktop layout (–∫–∞–∫ –≤ —ç—Ç–∞–ª–æ–Ω–µ) --- */
@media (min-width:1024px){
  .main-container{ flex-direction:row; align-items:center; justify-content:center; gap:40px; }
  .image-box{ order:1; flex:0 0 40%; margin-top:0; }
  .status-image{ height:70vh; max-width:100%; }
  .text-box{ order:2; flex:0 0 60%; display:flex; flex-direction:column; justify-content:center; align-items:center; }
}

/* --- Headline / results (—Ç–æ—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∏–∑ —ç—Ç–∞–ª–æ–Ω–∞) --- */
.round{
  font-weight:900; font-size:40px; line-height:1.1;
  text-align:center; color:#f08c22; margin:10px 0 16px;
}
.result{
  color:var(--muted); text-align:center; font-size:22px; min-height:28px; margin-bottom:8px;
}
.result.correct{ color:var(--green); }
.result.incorrect{ color:var(--red); }

/* --- Rows / word bank --- */
.row{ display:flex; align-items:center; justify-content:center; gap:8px; flex-wrap:wrap; padding:8px 0; }
.bank{ justify-content:center; }

/* --- Letter tiles --- */
.letter-box{
  display:inline-flex; align-items:center; justify-content:center;
  padding:8px 14px; border-radius:10px;
  background:var(--tile); border:2px solid var(--tile-border);
  font-weight:800; user-select:none; white-space:nowrap;
  box-shadow:0 1px 0 rgba(0,0,0,.03);
  transition:transform .06s ease, border-color .12s ease;
  cursor:pointer;
}
.letter-box:active{ transform:scale(0.96); }

/* –¶–≤–µ—Ç–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã —Å–ª–æ–≤ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ —É —Ç–µ–±—è, –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –æ–±—â–µ–π –≥–∞–º–º–µ) */
.word-color-0{ background:#e9f7ff; }
.word-color-1{ background:#fff7e9; }
.word-color-2{ background:#eafbea; }
.word-color-3{ background:#f3eaff; }
.word-color-4{ background:#ffeaf2; }
.word-color-5{ background:#f0f0f0; }

/* --- Buttons --- */
.submit-button,.restart-button,.nextbutton,.hint-button{
  border:none; border-radius:12px; padding:10px 18px; font-weight:800; cursor:pointer;
  box-shadow:0 2px 0 rgba(0,0,0,.08); transition:transform .06s ease, opacity .2s ease;
}
.submit-button{ background:var(--green); color:#fff; }
.submit-button:disabled{ opacity:.5; cursor:not-allowed; }

.hint-button{ margin-left:10px; background:#f0b429; color:#222; }
.restart-button.blue-button{ background:#0d6efd; color:#fff; }
.restart-button.red-button{ background:#dc3545; color:#fff; }
.nextbutton{ background:#6c757d; color:#fff; }

.center{ display:flex; justify-content:center; gap:10px; margin-top:12px; }

/* --- Hint FX --- */
@keyframes hintFlash{ 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
.hinted{ animation:hintFlash .4s ease; outline:2px dashed rgba(240,180,41,.7); }

/* Bank —Å—Ç–∏–ª–∏ –∫–∞–∫ –≤ —ç—Ç–∞–ª–æ–Ω–µ */
.bank .letter-box{
  background:#e6e6e6 !important; border-color:#cfcfcf !important; color:#444 !important; filter:none !important;
}
#mainWord .letter-box{ filter:none; }

/* --- Modal / end panel --- */
.endpanel{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.35); z-index:50;
}
.endpanel-card{
  background:#fff; color:#222; border-radius:16px; padding:18px 20px;
  width:min(560px,90vw); box-shadow:0 12px 40px rgba(0,0,0,.22);
}
.endpanel-title{ font-size:22px; font-weight:900; margin-bottom:6px; }
.endpanel-text{ font-size:18px; }

/* --- Mobile fine-tune --- */
@media (max-width:480px){
  .status-image{ height:auto; width:100%; }
}
  </style>
</head>
<body>
  <div class="header-container">
     <a href="index.html">
      <img src="img/header_cards.png" alt="Synonyms Logo" class="header-image">
    </a>
    <div class="score-box">
      <div class="score-line">
        ‚≠ê Score: <span id="currentScore">0/10</span>
        <span id="scoreEmojis"></span> | Hints: <span id="hintCount">0</span>
        <button id="hintButton" class="hint-button" onclick="showHint()" disabled>Hint</button>
      </div>
    </div>
  </div>
  <hr>

  <div class="main-container">
    <div class="image-box">
      <img id="statusImg" src="img/green/neutral.svg" alt="Status" class="status-image"
           onerror="this.dataset.fallback='1';this.alt='üôÇ'; this.removeAttribute('src');">
    </div>

    <div class="text-box">
      <div id="endPanel" class="endpanel" aria-live="polite">
        <div class="endpanel-card" role="dialog" aria-modal="true" aria-labelledby="endTitle">
          <div id="endTitle" class="endpanel-title">Results</div>
          <div id="endText" class="endpanel-text"></div>
          <div id="endButtons" class="center" style="margin-top:10px"></div>
        </div>
      </div>

      <div id="roundNumber" class="round">Round 1</div>
      <div id="result" class="result">Put the words in the correct order</div>

      <div id="mainWord" class="row" aria-label="Assembled sentence"></div>
      <div id="hiddenWord" class="row bank" aria-label="Word bank"></div>

      <div class="center">
        <button id="submitBtn" class="submit-button">Submit</button>
        <button id="nextBtn" class="nextbutton" style="display:none">Next</button>
        <button id="restartBtn" class="restart-button blue-button" style="display:none">Restart</button>
      </div>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º ¬´–±–∞–∑—É¬ª –î–û –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ -->
  <script src="combinations.js"></script>

  <script>
    // -----------------------------
    // –ù–ê–°–¢–†–û–ô–ö–ò
    // -----------------------------
    const ROUNDS_LIMIT = 10;

    // -----------------------------
    // –£–¢–ò–õ–´
    // -----------------------------
    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function tokenizeSentence(s){
      const tokens = [];
      s.trim().split(/\s+/).forEach(word=>{
        const m = word.match(/^(.+?)([.,!?;:]*)$/);
        if(m){ tokens.push(m[1]); if(m[2]) tokens.push(m[2]); }
        else { tokens.push(word); }
      });
      return tokens;
    }

    // –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å—Ç—Ä–æ–∫—É / –º–∞—Å—Å–∏–≤ / –æ–±—ä–µ–∫—Ç
    function normalizeEntry(entry){
      if(Array.isArray(entry)) return entry.slice(); // –º–∞—Å—Å–∏–≤ —Ç–æ–∫–µ–Ω–æ–≤
      if(typeof entry === 'string') return tokenizeSentence(entry);
      if(entry && typeof entry === 'object'){
        if(entry.tokens) return entry.tokens.slice();
        if(entry.sentence) return tokenizeSentence(entry.sentence);
      }
      return []; // fallback
    }

    function renderTokens(container, tokens, colorizeStartIndex=0){
      container.innerHTML = '';
      tokens.forEach((t, idx)=>{
        const span = document.createElement('span');
        span.className = 'letter-box word-color-' + ((idx+colorizeStartIndex)%6);
        span.textContent = t;
        span.addEventListener('click', ()=>{
          const parent = span.parentElement;
          if(parent.id === 'hiddenWord'){ $('#mainWord').appendChild(span); }
          else { $('#hiddenWord').appendChild(span); }
          ensureHintAvailability();
          ensureSubmitAvailability();
        });
        container.appendChild(span);
      });
    }

    function setStatus(kind){
      const img = $('#statusImg');
      const fall = img.dataset.fallback === '1';
      const map = {
        neutral:'img/green/neutral.svg',
        right:'img/green/right.svg',
        wrong:'img/green/wrong.svg'
      };
      if(!fall){ img.src = map[kind] || map.neutral; }
      else     { img.alt = kind==='right'?'‚úÖ':(kind==='wrong'?'‚ùå':'üôÇ'); }
    }

    // -----------------------------
    // –î–ê–ù–ù–´–ï (–±–µ—Ä–µ–º –∏–∑ combinations.js, –∏–Ω–∞—á–µ –¥–µ—Ñ–æ–ª—Ç)
    // -----------------------------
    const SOURCE = (window.COMBINATIONS && window.COMBINATIONS.length)
      ? window.COMBINATIONS
      : [
          "I would like a cup of coffee, please.",
          "She is reading a very interesting book.",
          "They have been living here for three years.",
          "We need to finish the project by Friday.",
          "Could you help me with this exercise?",
          "The weather is getting colder every day.",
          "He doesn't like to wake up early.",
          "Let's meet at the station at noon.",
          "This problem is more difficult than I expected.",
          "I am learning English to study abroad."
        ];

    // -----------------------------
    // –°–û–°–¢–û–Ø–ù–ò–ï –ò –ò–ì–†–ê
    // -----------------------------
    let currentRound = 1;
    let currentScore = 0;
    let hintCount = 0;

    let targetTokens = [];
    let bankTokens = [];

    function pickEntry(){
      const idx = (currentRound-1) % SOURCE.length;
      targetTokens = normalizeEntry(SOURCE[idx]);
      // –ø–µ—Ä–µ—Å—Ç–∞–≤–∏–º –±–∞–Ω–∫, —á—Ç–æ–±—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª 1:1
      do { bankTokens = shuffle(targetTokens); }
      while(JSON.stringify(bankTokens) === JSON.stringify(targetTokens) && targetTokens.length>1);
    }

    function updateHeader(){
      $('#roundNumber').textContent = `Round ${currentRound}`;
      $('#currentScore').textContent = `${currentScore}/${ROUNDS_LIMIT}`;
      $('#hintCount').textContent = `${hintCount}`;
    }

    function ensureHintAvailability(){
      $('#hintButton').disabled = $('#hiddenWord').children.length === 0;
    }
    function ensureSubmitAvailability(){
      const built = $$('#mainWord .letter-box').map(el=>el.textContent);
      $('#submitBtn').disabled = built.length !== targetTokens.length;
    }

    function flash(el){ el.classList.add('hinted'); setTimeout(()=>el.classList.remove('hinted'),450); }

    function showHint(){
      const built = $$('#mainWord .letter-box').map(el=>el.textContent);
      const nextIndex = built.length;
      const need = targetTokens[nextIndex];
      const bankEls = $$('#hiddenWord .letter-box');
      const candidate = bankEls.find(el=>el.textContent === need);
      if(candidate){
        $('#mainWord').appendChild(candidate);
        hintCount++; updateHeader(); flash(candidate);
        ensureHintAvailability(); ensureSubmitAvailability();
        $('#result').textContent = 'Hint used!';
      } else {
        const inMain = $$('#mainWord .letter-box');
        const wrongPos = inMain.find(el=>el.textContent === need && inMain.indexOf(el)!==nextIndex);
        if(wrongPos){
          $('#mainWord').insertBefore(wrongPos, inMain[nextIndex] || null);
          hintCount++; updateHeader(); flash(wrongPos);
          $('#result').textContent = 'Hint adjusted order!';
        }
      }
    }
    window.showHint = showHint;

    function checkAnswer(){
      const built = $$('#mainWord .letter-box').map(el=>el.textContent);
      const ok = JSON.stringify(built) === JSON.stringify(targetTokens);
      if(ok){
        currentScore++;
        $('#result').textContent = 'Correct! üéâ';
        $('#result').classList.remove('incorrect'); $('#result').classList.add('correct');
        setStatus('right');
      } else {
        $('#result').textContent = 'Not quite. Try again or use a hint.';
        $('#result').classList.remove('correct'); $('#result').classList.add('incorrect');
        setStatus('wrong');
      }
      $('#currentScore').textContent = `${currentScore}/${ROUNDS_LIMIT}`;
      $('#submitBtn').style.display = 'none';
      $('#nextBtn').style.display = 'inline-block';

      if(currentRound >= ROUNDS_LIMIT){
        $('#nextBtn').style.display = 'none';
        $('#restartBtn').style.display = 'inline-block';
        showEndPanel();
      }
    }
    window.checkAnswer = checkAnswer;

    function nextRound(){
      currentRound++;
      if(currentRound > ROUNDS_LIMIT) return;
      $('#result').textContent = "New round!";
      $('#result').classList.remove('correct','incorrect');
      setStatus('neutral');

      pickEntry();
      renderTokens($('#mainWord'), []);
      renderTokens($('#hiddenWord'), bankTokens, 1);

      updateHeader(); ensureHintAvailability();
      $('#submitBtn').style.display = 'inline-block';
      $('#nextBtn').style.display = 'none';
      $('#restartBtn').style.display = 'none';
      ensureSubmitAvailability();
    }

    function restartGame(){
      currentRound = 1; currentScore = 0; hintCount = 0; hideEndPanel(); nextRound();
    }

    function showEndPanel(){
      const panel = $('#endPanel'), text = $('#endText'), btns = $('#endButtons');
      text.innerHTML = `You scored <b>${currentScore}</b> out of <b>${ROUNDS_LIMIT}</b>.<br/>Hints used: <b>${hintCount}</b>.`;
      btns.innerHTML = '';
      const again = document.createElement('button');
      again.className = 'restart-button blue-button'; again.textContent = 'Play again';
      again.addEventListener('click', restartGame); btns.appendChild(again);
      panel.style.display = 'flex';
    }
    function hideEndPanel(){ $('#endPanel').style.display = 'none'; }

    function init(){
      $('#submitBtn').addEventListener('click', checkAnswer);
      $('#nextBtn').addEventListener('click', nextRound);
      $('#restartBtn').addEventListener('click', restartGame);

      pickEntry();
      renderTokens($('#mainWord'), []);
      renderTokens($('#hiddenWord'), bankTokens, 1);
      updateHeader(); ensureHintAvailability(); ensureSubmitAvailability(); setStatus('neutral');
    }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>