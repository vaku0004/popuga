<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Synonyms Game</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header-container">
    <img src="img/header_synonyms.png" alt="Synonyms Logo" class="header-image" />
    <div class="score-box">
      <div class="score-line">
        ⭐ Score: <span id="currentScore">0/10</span> <span id="scoreEmojis">⭐</span> |
        Hints: <span id="hintCount">0</span>
        <button id="hintButton" onclick="showHint()" disabled>Hint</button>
      </div>
    </div>
  </div>
  <hr>
  <div class="main-container">
    <div class="text-box">
      <div id="result" class="result">Let's get started!</div>
      <div id="mainWord">Word</div>
      <div id="hiddenWord"></div>
      <input id="userInput" placeholder="Enter synonym" />
      <button id="submitBtn" onclick="checkAnswer()">Submit</button>
      <div id="restartContainer"></div>
    </div>
    <div class="image-box">
      <img src="img/green/neutral.svg" alt="Status" class="status-image" />
    </div>
  </div>

  <script src="words.js"></script>
  <script>
    const statusImage = document.querySelector('.status-image');
    const TOTAL_ROUNDS = 10;
    const shuffledPairs = [...wordPairs].sort(() => Math.random() - 0.5).slice(0, TOTAL_ROUNDS);
    let currentIndex = 0, scoreToday = 0, usedHintsThisWord = 0;
    let availableHints = +localStorage.getItem('availableHints') || 0;
    const dateKey = new Date().toISOString().split('T')[0];
    const scoreHistory = JSON.parse(localStorage.getItem('synonymScores') || '{}');

    function updateHintDisplay() {
      document.getElementById('hintCount').textContent = availableHints;
      document.getElementById('hintButton').disabled = availableHints <= 0;
    }
    function updateCurrentScore() {
      document.getElementById('currentScore').textContent = `${scoreToday}/${TOTAL_ROUNDS}`;
      document.getElementById('scoreEmojis').textContent = '⭐'.repeat(scoreToday || 1);
    }
    function updateHiddenWord() {
      const container = document.getElementById('hiddenWord');
      container.innerHTML = '';
      const synonym = shuffledPairs[currentIndex].synonym;
      let reveal = usedHintsThisWord;
      const cw = container.clientWidth;
      const tb = document.createElement('div'); tb.className = 'letter-box'; tb.style.visibility = 'hidden'; tb.textContent = 'M'; container.appendChild(tb);
      const bw = tb.getBoundingClientRect().width;
      const gap = parseFloat(getComputedStyle(container).columnGap) || 4;
      container.removeChild(tb);
      const maxPerLine = Math.max(2, Math.floor((cw + gap) / (bw + gap)));

      synonym.split(' ').forEach((word, wi) => {
        let chunks = [];
        for (let i = 0; i < word.length; i += maxPerLine) chunks.push(word.slice(i, i + maxPerLine));
        if (chunks.length > 1 && chunks[chunks.length - 1].length < 2) {
          const last = chunks.pop(), prev = chunks.pop();
          const need = 2 - last.length;
          const newPrev = prev.slice(0, prev.length - need);
          const newLast = prev.slice(prev.length - need) + last;
          if (newPrev) chunks.push(newPrev);
          chunks.push(newLast);
        }
        chunks.forEach(chunk => {
          const grp = document.createElement('div'); grp.className = 'word-group';
          [...chunk].forEach(ch => {
            const box = document.createElement('div'); box.className = `letter-box word-color-${wi % 6}`;
            if (reveal-- > 0) { box.textContent = ch.toUpperCase(); box.classList.add('filled-box'); }
            grp.appendChild(box);
          });
          container.appendChild(grp);
        });
        const sp = document.createElement('div'); sp.className = 'space-box'; container.appendChild(sp);
      });
    }
    function displayWord() {
      usedHintsThisWord = 0;
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('userInput').value = '';
      document.getElementById('mainWord').textContent = shuffledPairs[currentIndex].main;
      statusImage.src = 'img/green/neutral.svg';
      updateHiddenWord();
      updateCurrentScore();
    }
    function showHint() {
      if (availableHints > 0) {
        usedHintsThisWord++;
        availableHints--;
        localStorage.setItem('availableHints', availableHints);
        updateHintDisplay();
        updateHiddenWord();
      }
    }
    function checkAnswer() {
      const input = document.getElementById('userInput').value.trim().toLowerCase();
      const correct = shuffledPairs[currentIndex].synonym.toLowerCase();
      const res = document.getElementById('result');
      res.classList.remove('correct', 'incorrect');

      if (input === correct) {
        scoreToday++;
        res.textContent = 'Correct!';
        res.classList.add('correct');
        statusImage.src = 'img/green/right.svg';
      } else {
        res.textContent = `Incorrect. Answer: ${correct}`;
        res.classList.add('incorrect');
        statusImage.src = 'img/green/wrong.svg';
      }

      if (currentIndex < TOTAL_ROUNDS - 1) {
        currentIndex++;
        setTimeout(displayWord, 800);
      } else {
        setTimeout(endGame, 800);
      }
    }
    function endGame() {
      scoreHistory[dateKey] = scoreToday;
      localStorage.setItem('synonymScores', JSON.stringify(scoreHistory));

      const res = document.getElementById('result');
      res.classList.remove('correct', 'incorrect');

      if (scoreToday === TOTAL_ROUNDS) {
        statusImage.src = 'img/green/winner.svg';
        availableHints++;
        localStorage.setItem('availableHints', availableHints);
        res.textContent = `Congratulations! You earned 1 hint. Your score: ${scoreToday}/${TOTAL_ROUNDS}.`;
      } else {
        statusImage.src = 'img/green/loser.svg';
        res.textContent = `Keep practicing to win next time. Your score: ${scoreToday}/${TOTAL_ROUNDS}.`;
      }

      document.getElementById('submitBtn').disabled = true;
      updateHintDisplay();
      document.getElementById('restartContainer').innerHTML = '<br><button onclick="startGame()">Start Again</button>';
    }
    function startGame() {
      currentIndex = 0;
      scoreToday = 0;
      usedHintsThisWord = 0;
      document.getElementById('result').textContent = "Let's get started!";
      document.getElementById('restartContainer').innerHTML = '';
      updateHintDisplay();
      displayWord();
      document.getElementById('userInput').focus();
    }
    document.getElementById('userInput').addEventListener('keyup', e => e.key === 'Enter' && checkAnswer());
    document.addEventListener('DOMContentLoaded', () => {
      updateHintDisplay();
      displayWord();
    });
  </script>
</body>
</html>