<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Synonyms Game</title>
  <link rel="stylesheet" href="synonyms.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Relief:wght@400;700&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Sniglet:wght@400;800&family=Varela+Round&display=swap" rel="stylesheet">
  <style>
    .fade-in {
      animation: fadeZoom 0.6s ease-out;
    }
    @keyframes fadeZoom {
      0% {
        opacity: 0;
        transform: scale(0.8) translateY(-10px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="header-container">
    <a href="index.html">
      <img src="img/header_synonyms.png" alt="Synonyms Logo" class="header-image" />
    </a>
    <div class="score-box">
      <div class="score-line">
        ‚≠ê Score: <span id="currentScore">0/10</span> <span id="scoreEmojis"></span> |
        Hints: <span id="hintCount">0</span>
        <button id="hintButton" class="hint-button" onclick="showHint()" disabled>Hint</button>
      </div>
    </div>
  </div>
  <hr>
  <div class="main-container">
    <div class="text-box">
      <div id="roundNumber" class="round"></div>

      <div>
        <div id="result" class="result" style="margin: 0; height: 100%;">Let's get started!</div>
      </div>
      <div id="mainWord">Word</div>
      <div id="hiddenWord"></div>
      <input id="userInput" placeholder="Enter synonym" />
      <button id="submitBtn" class="submit-button" onclick="checkAnswer()">Submit</button>
      <div id="restartContainer"></div>
    </div>
    <div class="image-box">
      <img src="img/green/neutral.svg" alt="Status" class="status-image" />
    </div>
  </div>

  <script src="words.js"></script>
  <script>
    const statusImage = document.querySelector('.status-image');
    const TOTAL_ROUNDS = 10;
    const shuffledPairs = [...wordPairs].sort(() => Math.random() - 0.5).slice(0, TOTAL_ROUNDS);
    let currentIndex = 0, scoreToday = 0, usedHintsThisWord = 0;
    let availableHints = +localStorage.getItem('availableHints') || 0;
    let starsEarned = +localStorage.getItem('starsEarned') || 0;
    const dateKey = new Date().toISOString().split('T')[0];
    const scoreHistory = JSON.parse(localStorage.getItem('synonymScores') || '{}');

    function updateHintDisplay() {
      document.getElementById('hintCount').textContent = availableHints;
      document.getElementById('hintButton').disabled = availableHints <= 0;
    }

    function updateCurrentScore() {
      document.getElementById('currentScore').textContent = `${scoreToday}/${TOTAL_ROUNDS}`;
      document.getElementById('scoreEmojis').textContent = 'üèÜ'.repeat(starsEarned);
    }

    function updateHiddenWord() {
      const container = document.getElementById('hiddenWord');
      container.innerHTML = '';
      const synonym = shuffledPairs[currentIndex].synonym;
      let reveal = usedHintsThisWord;
      const cw = container.clientWidth;
      const tb = document.createElement('div');
      tb.className = 'letter-box';
      tb.style.visibility = 'hidden';
      tb.textContent = 'M';
      container.appendChild(tb);
      const bw = tb.getBoundingClientRect().width;
      const gap = parseFloat(getComputedStyle(container).columnGap) || 4;
      container.removeChild(tb);
      const maxPerLine = Math.max(2, Math.floor((cw + gap) / (bw + gap)));

      synonym.split(' ').forEach((word, wi) => {
        let chunks = [];
        for (let i = 0; i < word.length; i += maxPerLine) chunks.push(word.slice(i, i + maxPerLine));
        if (chunks.length > 1 && chunks[chunks.length - 1].length < 2) {
          const last = chunks.pop(), prev = chunks.pop();
          const need = 2 - last.length;
          const newPrev = prev.slice(0, prev.length - need);
          const newLast = prev.slice(prev.length - need) + last;
          if (newPrev) chunks.push(newPrev);
          chunks.push(newLast);
        }
        chunks.forEach(chunk => {
          const grp = document.createElement('div');
          grp.className = 'word-group';
          [...chunk].forEach(ch => {
            const box = document.createElement('div');
            box.className = `letter-box word-color-${wi % 6}`;
            if (ch === '-') {
              box.textContent = '-';
              box.classList.add('filled-box');
            } else if (reveal-- > 0) {
              box.textContent = ch.toUpperCase();
              box.classList.add('filled-box');
            }
            grp.appendChild(box);
          });
          container.appendChild(grp);
        });
        const sp = document.createElement('div');
        sp.className = 'space-box';
        container.appendChild(sp);
      });
    }

    function displayWord() {
      usedHintsThisWord = 0;
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = false;
      document.getElementById('userInput').value = '';
      document.getElementById('mainWord').textContent = shuffledPairs[currentIndex].main;
      document.getElementById('result').textContent = '';
      document.getElementById('result').classList.remove('correct', 'incorrect');
      statusImage.src = 'img/green/neutral.svg';

      const roundText = document.getElementById('roundNumber');
      roundText.textContent = `Round ${currentIndex + 1}`;
      roundText.classList.remove('fade-in');
      void roundText.offsetWidth;
      roundText.classList.add('fade-in');

      updateHiddenWord();
      updateCurrentScore();
    }

    function showHint() {
      if (availableHints > 0) {
        usedHintsThisWord++;
        availableHints--;
        localStorage.setItem('availableHints', availableHints);
        updateHintDisplay();
        updateHiddenWord();
      }
    }

    function checkAnswer() {
      const input = document.getElementById('userInput').value.trim().toLowerCase();
      const correct = shuffledPairs[currentIndex].synonym.toLowerCase();
      const res = document.getElementById('result');
      const submitBtn = document.getElementById('submitBtn');
      res.classList.remove('correct', 'incorrect');

      let delay;
      if (input === correct) {
        scoreToday++;
        availableHints++;
        res.textContent = 'Correct!';
        res.classList.add('correct');
        statusImage.src = 'img/green/right.svg';
        delay = 2000;
      } else {
        availableHints = Math.max(0, availableHints - 1);
        res.textContent = `Incorrect. Answer: ${correct}`;
        res.classList.add('incorrect');
        statusImage.src = 'img/green/wrong.svg';
        delay = 5000;
      }

      submitBtn.disabled = true;
      localStorage.setItem('availableHints', availableHints);
      updateHintDisplay();

      if (currentIndex < TOTAL_ROUNDS - 1) {
        currentIndex++;
        setTimeout(() => {
          submitBtn.disabled = false;
          displayWord();
        }, delay);
      } else {
        setTimeout(() => {
          submitBtn.disabled = false;
          endGame();
        }, delay);
      }
    }

    function endGame() {
      scoreHistory[dateKey] = scoreToday;
      localStorage.setItem('synonymScores', JSON.stringify(scoreHistory));

      const res = document.getElementById('result');
      res.classList.remove('correct', 'incorrect');

      if (scoreToday === TOTAL_ROUNDS) {
        statusImage.src = 'img/green/medal.png'; // –ú–µ–¥–∞–ª—å –ø—Ä–∏ –ø–æ–±–µ–¥–µ
        starsEarned++;
        if (starsEarned >= 3) {
          availableHints += 10;
          starsEarned = 0;
        }
        localStorage.setItem('availableHints', availableHints);
        localStorage.setItem('starsEarned', starsEarned);
        res.textContent = `üèÜ Congratulations! You won! Your score: ${scoreToday}/${TOTAL_ROUNDS}.`;
      } else {
        statusImage.src = 'img/green/loser.svg';
        res.textContent = `Keep practicing to win next time. Your score: ${scoreToday}/${TOTAL_ROUNDS}.`;
      }

      document.getElementById('submitBtn').disabled = true;
      updateHintDisplay();
      updateCurrentScore();
      document.getElementById('restartContainer').innerHTML = '<br><button class="restart-button" onclick="startGame()">Start Again</button>';
    }

    function startGame() {
      currentIndex = 0;
      scoreToday = 0;
      usedHintsThisWord = 0;
      document.getElementById('result').textContent = "Let's get started!";
      document.getElementById('restartContainer').innerHTML = '';
      updateHintDisplay();
      updateCurrentScore();
      displayWord();
      document.getElementById('userInput').focus();
    }

    document.getElementById('userInput').addEventListener('keyup', e => {
      if (e.key === 'Enter') checkAnswer();
    });

    document.addEventListener('DOMContentLoaded', () => {
      updateHintDisplay();
      updateCurrentScore();
      displayWord();
    });
  </script>
</body>
</html>
